name: Sync IPs from Nutstore

on:
  # 允许手动触发或通过 API 触发
  workflow_dispatch:

jobs:
  update-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download result.txt from Nutstore
        run: |
          # 使用 WebDAV 直接下载原始文件，比抓取网页更稳定
          curl -u "2671174616@qq.com:anfk8qdcdjibsvmk" \
               -o youxuan.txt \
               "https://dav.jianguoyun.com/dav/ScriptCat/result.txt"

      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "actions@github.com"
          
          # 检查文件是否有变化
          if git diff --quiet youxuan.txt; then
            echo "数据未变化，跳过更新。"
          else
            git add youxuan.txt
            git commit -m "自动更新优选IP: $(date +'%Y-%m-%d %H:%M:%S')"
            git push
          fi
